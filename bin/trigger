#!/bin/bash

set -o nounset  # -u
set -o errexit  # -e
set -o pipefail # ...

#-------------------------------------------------

usage() {
  cat >&2 <<EOM
Usage: $(basename "$0") [OPTION]... -c "command to run" [FILES-TO-WATCH]

  -c          command to run -- defaults to "make"
  -h          display help
EOM
  exit 1
}

#-------------------------------------------------

COMMAND="make"

while getopts "c:h" opt; do
  case "$opt" in
    c)
      COMMAND=$OPTARG
      ;;
    h|*)
      usage
      ;;
  esac
done

shift $((OPTIND - 1))

#-------------------------------------------------

fswatch "$@" -o | xargs -I% sh -c "$COMMAND; ding \$?"

