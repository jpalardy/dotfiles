#!/bin/bash

awk '

# -------------------------------------------------

# head $table
$1 == "head" {
  table = $2
  if (!table) { table = "_table_" }

  $0 = sprintf("SELECT * FROM %s LIMIT 25", table)
}

# -------------------------------------------------

# sample $table
$1 == "sample" {
  table = $2
  if (!table) { table = "_table_" }

  $0 = sprintf("SELECT * FROM %s ORDER BY random() LIMIT 25", table)
}

# -------------------------------------------------

# count $table
$1 == "count" {
  table = $2
  if (!table) { table = "_table_" }

  $0 = sprintf("SELECT _column_, count(*) FROM %s GROUP BY 1 ORDER BY 1", table)
}

# -------------------------------------------------

{
  sub(";$", "")
  print
}

END {
  print ";"
}

' "$@" | pg_format --wrap-after 10 --no-extra-line

