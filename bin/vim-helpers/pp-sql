#!/bin/bash

awk '

# head $table
NF == 2 && $1 == "head" {
  $0 = sprintf("SELECT * FROM %s LIMIT 15", $2)
}

# count $table
NF == 2 && $1 == "count" {
  $0 = sprintf("SELECT count(*) FROM %s", $2)
}

# count $column $table
NF == 3 && $1 == "count" {
  $0 = sprintf("SELECT %s, count(*) FROM %s GROUP BY %s ORDER BY %s DESC", $2, $3, $2, $2)
}

# count all tables -- postgres
NF == 1 && $1 == "pg_count" {
  $0 = "SELECT schemaname, relname, n_live_tup FROM pg_stat_user_tables ORDER BY schemaname, relname"
}

{
  sub(";$", "")
  print
}

END {
  print ";"
}

' "$@" | pg_format --wrap-after 10 --no-extra-line

