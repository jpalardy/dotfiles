#!/bin/bash

# pg_format might not be installed
format() {
  if test "$(command -v pg_format)"; then
    pg_format --wrap-after 10 --no-extra-line
  else
    cat
  fi
}

# -------------------------------------------------

awk '

# -------------------------------------------------
# head $table
# -------------------------------------------------

$1 == "head" {
  table = $2
  if (!table) { table = "_table_" }

  $0 = sprintf("SELECT * FROM %s LIMIT 5", table)
}

# -------------------------------------------------
# count $table
# -------------------------------------------------

$1 == "count" {
  table = $2
  if (!table) { table = "_table_" }

  $0 = sprintf("SELECT _column_, count(*) FROM %s GROUP BY 1 ORDER BY 1", table)
}

# -------------------------------------------------

{
  sub(";$", "")
  print
}

END {
  print ";"
}

' "$@" | format

