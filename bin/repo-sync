#!/bin/bash

REPOS=${REPOS:?"environment variable REPOS is empty"}

# warm ssh connection, ugly...
ssh droplet.jpalardy.com exit

quick=0

if [[ $1 == "-q" ]]; then
  quick=1
  shift
fi

cmd=""
i=0
for repo in $REPOS; do
  i=$((i + 1))
  if [[ $i == 1 ]]; then
    if [[ -z $TMUX ]]; then
      cmd+="tmux new-session "
    else
      cmd+="tmux split-window "
    fi
  else
    cmd+="\; split-window "
  fi
  cmd+="'cd $repo; "
  if [[ $quick == 0 ]]; then
    cmd+="git fp; "
  fi
  cmd+="git st; exec $SHELL'"
done
cmd+="\; select-layout even-vertical"

eval "$cmd"

