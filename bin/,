#!/bin/bash

list_commands() {
  # node.js -related
  if [ -e "package.json" ]; then
    echo "npm outdated"
    echo "ncu -u; npm install; git add package*; npm audit fix"
    echo "rm package-lock.json; npm install"
  fi
  # go -related
  if [ -e "go.mod" ]; then
    echo "go get -u"
    echo "go mod tidy"
  fi
  # elixir
  if [ -e "mix.exs" ]; then
    echo "mix deps.get"
    echo "mix deps.compile"
    echo "mix compile"
    echo ""
    test -d _build     && echo "rm -rf -v _build"
    test -d deps       && echo "rm -rf -v deps"
    test -d .elixir_ls && echo "rm -rf -v .elixir_ls"
  fi
}

pick=$(list_commands | fzf --exit-0)

if [ -z "$pick" ]; then
  exit
fi

eval "$pick"

