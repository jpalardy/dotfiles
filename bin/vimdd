#!/bin/bash

die() {
  echo >&2 "$@"
  exit 1
}

if [ $# -ne 2 ]; then
  die "usage: $0 dir1 dir2"
fi

diff -rq "$@" | awk -v dir1="$1" -v dir2="$2" '

BEGIN {
  sub("/$", "", dir1)
  sub("/$", "", dir2)
}

/^Files / {
  print "vimdiff", $2, $4
}

/^Only in/ {
  print "vimdiff", dir1 "/" $NF, dir2 "/" $NF
}

'

