#!/bin/bash

usage() {
  cat >&2 <<EOM
Usage: $(basename "$0") -c [path]

  -c          use cp, instead of mv
  -h          display help
EOM
  exit "${1:-0}"
}

# -------------------------------------------------

cmd="mv"

while getopts "ch" opt; do
  case "$opt" in
    c)
      cmd="cp"
      ;;
    h)
      usage
      ;;
    *)
      usage 1
      ;;
  esac
done

shift $((OPTIND - 1))

tmpfile=$(mktemp)
path="${1:-"$HOME/Downloads"}"

# -------------------------------------------------

# remove trailing /
path="${path%/}"

set trap
cleanup() {
  rm -f "$tmpfile" INT TERM EXIT
}
trap cleanup INT TERM EXIT

(echo; ls -t "$path") > "$tmpfile"
${VISUAL:-${EDITOR:-vi}} "$tmpfile"

awk -v path="$path" -v cmd="$cmd" '
# done on empty line
NF == 0 { exit }
{ printf "%s -v \"%s/%s\" .\n", cmd, path, $0, "." }
' "$tmpfile" | bash

