#!/bin/bash

path="${1:-"$HOME/Downloads"}"
tmpfile=$(mktemp)

# remove trailing /
path="${path%/}"

set trap
cleanup() {
  rm -f "$tmpfile" INT TERM EXIT
}
trap cleanup INT TERM EXIT

(ls -t "$path" | awk 'BEGIN { print "" } { print "m", $0 }') > "$tmpfile"
${VISUAL:-${EDITOR:-vi}} "$tmpfile"

awk -v path="$path" '
{ cmd = "" }
$1 == "m" { cmd = "mv" }
$1 == "c" { cmd = "cp" }

# done on empty line, or invalid line
cmd == "" { exit }

{
  filename=gensub("^. ", "", 1, $0)
  printf "%s -v \"%s/%s\" .\n", cmd, path, filename, "."
}
' "$tmpfile" | bash

