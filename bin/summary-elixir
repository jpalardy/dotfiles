#!/bin/bash

awk '

$1 == "@impl" {
  impl = 1
}

$1 == "def" {
  sub("\\(.*", "")
  if (impl) {
    # bold
    printf "\033[1m"
  }
  # green
  print "\033[32m" $1, $2 "\033[0m"
  impl = 0
}

$1 == "defp" {
  sub("\\(.*", "")
  # (dim) gray
  print "\033[2m" $1, $2 "\033[0m"
}

$1 == "defmacro" {
  sub("\\(.*", "")
  # red
  print "\033[31m" $1, $2 "\033[0m"
}

$1 == "defimpl" || $1 == "@callback" || $1 == "@behaviour" {
  sub("^ +", "")
  # yellow
  print "\033[33m" $0 "\033[0m"
}

$1 == "describe" {
  print
}

$1 == "test" {
  print
}

' "$@" | uniq -c | awk '

$1 == 1 {
  sub("1", " ")
}

{ print }

'

