#!/bin/bash

awk '
$1 == "def" || $1 == "defp" {
  sub("\\(.*", "")
  print $1, $2
}

$1 == "describe" {
  print
}

$1 == "test" {
  print
}

$1 == "@callback"  { sub("^ +", "*** "); print }
$1 == "@behaviour" { sub("^ +", "*** "); print }
$1 == "@impl"      { sub("^ +", "*** "); print }

' "$@" | uniq -c | awk '

$1 == 1 {
  sub("1", " ")
}

{ print }

'

